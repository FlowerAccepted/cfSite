---
import BaseLayout from "../layouts/BaseLayout.astro";
const API_BASE = import.meta.env.PUBLIC_API_BASE;
---

<BaseLayout title="登录 - FAc's Site">
  <section class="title-section glass-panel">
    <h1>登录</h1>
  </section>

  <section class="glass-panel align-center">
    <input id="username" class="glass-input" placeholder="用户名" /><br />
    <input id="password" class="glass-input" type="password" placeholder="密码" /><br />
    <button class="glass-btn" id="login-btn" disabled>登录</button>
    <p id="msg"></p>
    没有账号？<a class="basic-href" href="/register">点我注册！</a>
  </section>

  <script type="module" define:vars={{ API_BASE }}>
    import { setupAuth } from "../auth.js";

    setupAuth(API_BASE);

    document
      .getElementById("login-btn")
      .addEventListener("click", () => {
        window.login();
      });
    const usernameInput = document.getElementById("username");
    const passwordInput = document.getElementById("password");
    const loginBtn = document.getElementById("login-btn");

    function updateLoginState() {
      const valid =
        usernameInput.value.trim().length > 0 &&
        passwordInput.value.length > 0;

      loginBtn.disabled = !valid;
    }

    [usernameInput, passwordInput].forEach(el => {
      el.addEventListener("input", updateLoginState);
    });
    loginBtn.addEventListener("click", () => {
      if (loginBtn.disabled) return;
      login();
    });
  </script>
</BaseLayout>
